<Window x:Class="ExcelSP2.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:properties="clr-namespace:ExcelSP2.Properties"
        mc:Ignorable="d"
        Title="{x:Static properties:Resources.Settings}" Height="600" Width="800" WindowStartupLocation="CenterScreen">
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TabControl Grid.Row="0">
            <!-- Prompt Management -->
            <TabItem Header="{x:Static properties:Resources.PromptManagement}">
                <Grid Margin="5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="200"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Text="{x:Static properties:Resources.Prompts}" FontWeight="Bold" Margin="0,0,0,5"/>
                    <ListBox x:Name="lstPrompts" Grid.Row="1" Margin="0,0,5,0" DisplayMemberPath="Title" SelectionChanged="LstPrompts_SelectionChanged"/>
                    
                    <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,5,5,0">
                        <Button x:Name="btnAddPrompt" Content="{x:Static properties:Resources.Add}" Width="60" Margin="0,0,5,0" Click="BtnAddPrompt_Click"/>
                        <Button x:Name="btnDeletePrompt" Content="{x:Static properties:Resources.Delete}" Width="60" Click="BtnDeletePrompt_Click"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Grid.RowSpan="3">
                        <TextBlock Text="{x:Static properties:Resources.Title}" FontWeight="Bold"/>
                        <TextBox x:Name="txtPromptTitle" Margin="0,5,0,10"/>
                        <TextBlock Text="{x:Static properties:Resources.Content}" FontWeight="Bold"/>
                        <TextBox x:Name="txtPromptContent" Height="300" AcceptsReturn="True" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" Margin="0,5,0,0"/>
                        <Button x:Name="btnSavePrompt" Content="{x:Static properties:Resources.SaveChanges}" HorizontalAlignment="Right" Margin="0,10,0,0" Width="100" Click="BtnSavePrompt_Click"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- VBA Macro Management -->
            <TabItem Header="{x:Static properties:Resources.VBAMacroManagement}">
                <Grid Margin="5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="200"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="3*"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="1*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Text="{x:Static properties:Resources.LocalMacros}" FontWeight="Bold" Margin="0,0,0,5"/>
                    <ListBox x:Name="lstMacros" Grid.Row="1" Margin="0,0,5,0" DisplayMemberPath="Title" SelectionChanged="LstMacros_SelectionChanged"/>

                    <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,5,5,10">
                        <Button x:Name="btnAddMacro" Content="{x:Static properties:Resources.Add}" Width="60" Margin="0,0,5,0" Click="BtnAddMacro_Click"/>
                        <Button x:Name="btnDeleteMacro" Content="{x:Static properties:Resources.Delete}" Width="60" Click="BtnDeleteMacro_Click"/>
                        <Button x:Name="btnImportMacro" Content="{x:Static properties:Resources.Import}" Width="60" Margin="5,0,0,0" Click="BtnImportMacro_Click"/>
                    </StackPanel>

                    <TextBlock Grid.Row="3" Text="{x:Static properties:Resources.InFileMacros}" FontWeight="Bold" Margin="0,0,0,5"/>
                    <ListBox x:Name="lstInFileMacros" Grid.Row="4" Margin="0,0,5,0" DisplayMemberPath="Title" SelectionChanged="LstInFileMacros_SelectionChanged"/>

                    <StackPanel Grid.Column="1" Grid.RowSpan="5">
                        <TextBlock Text="{x:Static properties:Resources.Title}" FontWeight="Bold"/>
                        <TextBox x:Name="txtMacroTitle" Margin="0,5,0,10"/>
                        <TextBlock Text="{x:Static properties:Resources.Code}" FontWeight="Bold"/>
                        <TextBox x:Name="txtMacroCode" Height="300" AcceptsReturn="True" FontFamily="Consolas" VerticalScrollBarVisibility="Auto" Margin="0,5,0,0"/>
                        <Button x:Name="btnSaveMacro" Content="{x:Static properties:Resources.SaveChanges}" HorizontalAlignment="Right" Margin="0,10,0,0" Width="100" Click="BtnSaveMacro_Click"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- LLM Management -->
            <TabItem Header="{x:Static properties:Resources.LLMManagement}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="5">
                        <!-- Local Detection -->
                        <GroupBox Header="{x:Static properties:Resources.LocalModelDetection}" Margin="0,0,0,10">
                            <StackPanel Orientation="Horizontal" Margin="5">
                                <Button x:Name="btnDetectModels" Content="{x:Static properties:Resources.DetectLocalModels}" Padding="5" Click="BtnDetectModels_Click"/>
                                <TextBlock x:Name="lblDetectionStatus" Text="" VerticalAlignment="Center" Margin="10,0,0,0" Foreground="Gray"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Mode Toggle -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <TextBlock Text="{x:Static properties:Resources.Mode}" VerticalAlignment="Center" FontWeight="Bold" Margin="0,0,10,0"/>
                            <RadioButton x:Name="rbSimple" Content="{x:Static properties:Resources.SimpleSettings}" GroupName="Mode" IsChecked="True" Checked="Mode_Checked"/>
                            <RadioButton x:Name="rbAdvanced" Content="{x:Static properties:Resources.AdvancedSettings}" GroupName="Mode" Margin="10,0,0,0" Checked="Mode_Checked"/>
                        </StackPanel>

                        <!-- Simple Settings -->
                        <GroupBox x:Name="grpSimple" Header="{x:Static properties:Resources.SimpleSettings}" Margin="0,0,0,10">
                            <StackPanel Margin="5">
                                <TextBlock Text="{x:Static properties:Resources.SimpleModeNote}" Foreground="OrangeRed" TextWrapping="Wrap" Margin="0,0,0,10" FontSize="11"/>
                                <TextBlock Text="{x:Static properties:Resources.Provider}" Margin="0,5,0,0"/>
                                <ComboBox x:Name="cmbSimpleProvider" SelectionChanged="CmbSimpleProvider_SelectionChanged">
                                    <ComboBoxItem Content="Custom (OpenAI Compatible)"/>
                                    <ComboBoxItem Content="Ollama"/>
                                    <ComboBoxItem Content="LM Studio"/>
                                </ComboBox>
                                
                                <TextBlock Text="{x:Static properties:Resources.ApiUrl}" Margin="0,5,0,0"/>
                                <TextBox x:Name="txtSimpleApiUrl"/>
                                
                                <StackPanel x:Name="pnlSimpleApiKey">
                                    <TextBlock Text="{x:Static properties:Resources.ApiKey}" Margin="0,5,0,0"/>
                                    <TextBox x:Name="txtSimpleApiKey"/>
                                </StackPanel>
                                
                                <TextBlock Text="{x:Static properties:Resources.Model}" Margin="0,5,0,0"/>
                                <ComboBox x:Name="cmbSimpleModel" IsEditable="True"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Advanced Settings -->
                        <StackPanel x:Name="pnlAdvanced" Visibility="Collapsed">
                            <!-- Header Detection -->
                            <GroupBox Header="{x:Static properties:Resources.HeaderDetection}" Margin="0,0,0,10">
                                <StackPanel Margin="5">
                                    <TextBlock Text="{x:Static properties:Resources.RequiresMultimodal}" Foreground="OrangeRed" FontSize="10" Margin="0,0,0,5"/>
                                    <TextBlock Text="{x:Static properties:Resources.Provider}"/>
                                    <ComboBox x:Name="cmbHeaderProvider" SelectionChanged="CmbAdvancedProvider_SelectionChanged" Tag="Header">
                                        <ComboBoxItem Content="Custom (OpenAI Compatible)"/>
                                        <ComboBoxItem Content="Ollama"/>
                                        <ComboBoxItem Content="LM Studio"/>
                                    </ComboBox>
                                    <Grid Margin="0,5,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" Margin="0,0,5,0">
                                            <TextBlock Text="{x:Static properties:Resources.ApiUrl}"/>
                                            <TextBox x:Name="txtHeaderApiUrl"/>
                                        </StackPanel>
                                        <StackPanel x:Name="pnlHeaderApiKey" Grid.Column="1" Margin="0,0,5,0">
                                            <TextBlock Text="{x:Static properties:Resources.ApiKey}"/>
                                            <TextBox x:Name="txtHeaderApiKey"/>
                                        </StackPanel>
                                        <StackPanel Grid.Column="2">
                                            <TextBlock Text="{x:Static properties:Resources.Model}"/>
                                            <ComboBox x:Name="cmbHeaderModel" IsEditable="True"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </GroupBox>

                            <!-- Data Write -->
                            <GroupBox Header="{x:Static properties:Resources.DataWriteSection}" Margin="0,0,0,10">
                                <StackPanel Margin="5">
                                    <TextBlock Text="{x:Static properties:Resources.RequiresMultimodal}" Foreground="OrangeRed" FontSize="10" Margin="0,0,0,5"/>
                                    <TextBlock Text="{x:Static properties:Resources.Provider}"/>
                                    <ComboBox x:Name="cmbWriteProvider" SelectionChanged="CmbAdvancedProvider_SelectionChanged" Tag="Write">
                                        <ComboBoxItem Content="Custom (OpenAI Compatible)"/>
                                        <ComboBoxItem Content="Ollama"/>
                                        <ComboBoxItem Content="LM Studio"/>
                                    </ComboBox>
                                    <Grid Margin="0,5,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" Margin="0,0,5,0">
                                            <TextBlock Text="{x:Static properties:Resources.ApiUrl}"/>
                                            <TextBox x:Name="txtWriteApiUrl"/>
                                        </StackPanel>
                                        <StackPanel x:Name="pnlWriteApiKey" Grid.Column="1" Margin="0,0,5,0">
                                            <TextBlock Text="{x:Static properties:Resources.ApiKey}"/>
                                            <TextBox x:Name="txtWriteApiKey"/>
                                        </StackPanel>
                                        <StackPanel Grid.Column="2">
                                            <TextBlock Text="{x:Static properties:Resources.Model}"/>
                                            <ComboBox x:Name="cmbWriteModel" IsEditable="True"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </GroupBox>

                            <!-- Data OP -->
                            <GroupBox Header="{x:Static properties:Resources.DataOperation}" Margin="0,0,0,10">
                                <StackPanel Margin="5">
                                    <TextBlock Text="{x:Static properties:Resources.TextOnlySufficient}" Foreground="Gray" FontSize="10" Margin="0,0,0,5"/>
                                    <TextBlock Text="{x:Static properties:Resources.Provider}"/>
                                    <ComboBox x:Name="cmbOpProvider" SelectionChanged="CmbAdvancedProvider_SelectionChanged" Tag="Op">
                                        <ComboBoxItem Content="Custom (OpenAI Compatible)"/>
                                        <ComboBoxItem Content="Ollama"/>
                                        <ComboBoxItem Content="LM Studio"/>
                                    </ComboBox>
                                    <Grid Margin="0,5,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" Margin="0,0,5,0">
                                            <TextBlock Text="{x:Static properties:Resources.ApiUrl}"/>
                                            <TextBox x:Name="txtOpApiUrl"/>
                                        </StackPanel>
                                        <StackPanel x:Name="pnlOpApiKey" Grid.Column="1" Margin="0,0,5,0">
                                            <TextBlock Text="{x:Static properties:Resources.ApiKey}"/>
                                            <TextBox x:Name="txtOpApiKey"/>
                                        </StackPanel>
                                        <StackPanel Grid.Column="2">
                                            <TextBlock Text="{x:Static properties:Resources.Model}"/>
                                            <ComboBox x:Name="cmbOpModel" IsEditable="True"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </GroupBox>

                            <!-- VBA Self-healing -->
                            <GroupBox Header="{x:Static properties:Resources.VBAEnvironmentDetection}" Margin="0,0,0,10">
                                <StackPanel Margin="5">
                                    <TextBlock Text="{x:Static properties:Resources.TextOnlySufficientSimple}" Foreground="Gray" FontSize="10" Margin="0,0,0,5"/>
                                    <TextBlock Text="{x:Static properties:Resources.Provider}"/>
                                    <ComboBox x:Name="cmbVbaProvider" SelectionChanged="CmbAdvancedProvider_SelectionChanged" Tag="Vba">
                                        <ComboBoxItem Content="Custom (OpenAI Compatible)"/>
                                        <ComboBoxItem Content="Ollama"/>
                                        <ComboBoxItem Content="LM Studio"/>
                                    </ComboBox>
                                    <Grid Margin="0,5,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" Margin="0,0,5,0">
                                            <TextBlock Text="{x:Static properties:Resources.ApiUrl}"/>
                                            <TextBox x:Name="txtVbaApiUrl"/>
                                        </StackPanel>
                                        <StackPanel x:Name="pnlVbaApiKey" Grid.Column="1" Margin="0,0,5,0">
                                            <TextBlock Text="{x:Static properties:Resources.ApiKey}"/>
                                            <TextBox x:Name="txtVbaApiKey"/>
                                        </StackPanel>
                                        <StackPanel Grid.Column="2">
                                            <TextBlock Text="{x:Static properties:Resources.Model}"/>
                                            <ComboBox x:Name="cmbVbaModel" IsEditable="True"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </GroupBox>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>

        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
            <Button x:Name="btnOk" Content="{x:Static properties:Resources.OK}" Width="80" Margin="0,0,10,0" Click="BtnOk_Click"/>
            <Button x:Name="btnCancel" Content="{x:Static properties:Resources.Cancel}" Width="80" Click="BtnCancel_Click"/>
        </StackPanel>
    </Grid>
</Window>
